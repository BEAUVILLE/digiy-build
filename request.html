async function submitDemande(formData){
  const params = new URLSearchParams(location.search);
  const artisanId = params.get('artisan_id');
  
  try {
    const { data, error } = await sb
      .from('digiy_build_demandes')
      .insert({
        artisan_id: artisanId,
        client_nom: formData.get('nom'),
        client_phone: formData.get('phone'),
        client_ville: formData.get('ville'),
        type_travaux: formData.get('type_travaux'),
        description_projet: formData.get('description'),
        budget_estime: formData.get('budget') ? parseInt(formData.get('budget')) : null,
        urgence: formData.get('urgence'),
        status: 'pending',
        created_at: new Date().toISOString()
      })
      .select()
      .single();

    if(error) throw error;

    console.log('✅ Demande créée:', data);
    
    // Redirection success
    location.href = './success.html?demande_id=' + data.id;
    
  } catch(err) {
    console.error('❌ Erreur:', err);
    alert('Erreur: ' + (err?.message || err));
  }
}
