<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>DIGIY BUILD ‚Äî R√©seau BTP S√©n√©gal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    :root{
      --bg:#020617;
      --accent:#facc15;
      --orange:#f97316;
      --ink:#f9fafb;
      --muted:#9ca3af;
      --line:#1f2937;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      margin:0;
      background:radial-gradient(circle,#111827,#020617);
      color:var(--ink);
      font-family:system-ui,sans-serif;
      padding:20px;
    }
    .container{max-width:1200px;margin:0 auto}
    .header{text-align:center;margin-bottom:30px}
    .header h1{font-size:48px;font-weight:900;color:var(--orange);margin:0}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:30px}
    .card{
      background:#0b1220;
      border:1px solid var(--line);
      border-radius:16px;
      padding:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.5);
    }
    .card.real{border:2px solid #22c55e} /* ‚úÖ Vrais artisans en vert */
    .card.placeholder{border:2px solid #f97316} /* ‚úÖ Placebots en orange */
    .photo{
      width:100%;
      height:200px;
      border-radius:12px;
      overflow:hidden;
      background:#111;
      margin-bottom:15px;
    }
    .photo img{width:100%;height:100%;object-fit:cover}
    .name{font-size:20px;font-weight:800;color:var(--accent);margin-bottom:5px}
    .entreprise{font-size:14px;color:var(--orange);margin-bottom:10px}
    .type{font-size:14px;color:var(--muted);margin-bottom:10px}
    .desc{font-size:14px;color:#e5e7eb;line-height:1.6;margin-bottom:15px}
    .badges{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:15px}
    .badge{
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      background:rgba(249,115,22,0.2);
      color:var(--orange);
      border:1px solid var(--orange);
    }
    .badge.real{background:#22c55e;color:#000;border-color:#22c55e}
    .btn{
      width:100%;
      padding:12px;
      border:none;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      margin-top:10px;
    }
    .btn-primary{background:var(--orange);color:#111}
    .btn-wa{background:#25d366;color:#fff}
    .loading{text-align:center;padding:50px;color:#fff;font-size:18px}
    .debug{
      background:#1a1a2e;
      border:1px solid #444;
      border-radius:8px;
      padding:15px;
      margin:20px 0;
      font-family:monospace;
      font-size:12px;
      color:#0f0;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üèóÔ∏è DIGIY BUILD</h1>
    <p style="color:var(--muted);font-size:18px">R√©seau BTP S√©n√©gal ‚Ä¢ 0% commission</p>
  </div>

  <!-- ‚úÖ DEBUG INFO -->
  <div id="debug" class="debug"></div>

  <div id="grid" class="grid"></div>
</div>

<script>
const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const grid = document.getElementById("grid");
const debugEl = document.getElementById("debug");
const TEAM_WA = "+221771342889";

// ‚úÖ PLACEBOTS
const PLACEBOTS = [
  {
    id: "pb-1",
    nom_complet: "Moussa DIOP",
    entreprise: "DIOP MA√áONNERIE",
    ville: "Dakar",
    specialite: "Ma√ßonnerie",
    annees_experience: 15,
    photo_profil: "https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=800",
    tarif_journee: 18000,
    description: "Ma√ßon professionnel depuis 15 ans. Fondations, dalles, murs porteurs.",
    nb_projets_realises: 120,
    whatsapp: TEAM_WA,
    slug: "moussa-diop-dakar",
    _isPlaceholder: true
  },
  {
    id: "pb-2",
    nom_complet: "Ibrahima FALL",
    entreprise: "FALL PLOMBERIE",
    ville: "Thi√®s",
    specialite: "Plomberie",
    annees_experience: 10,
    photo_profil: "https://images.unsplash.com/photo-1621905251918-48416bd8575a?w=800",
    tarif_journee: 15000,
    description: "Plombier qualifi√©. Installation sanitaire, r√©paration.",
    nb_projets_realises: 85,
    whatsapp: TEAM_WA,
    slug: "ibrahima-fall-thies",
    _isPlaceholder: true
  },
  {
    id: "pb-3",
    nom_complet: "Abdoulaye SARR",
    entreprise: "√âLECTRICIT√â SARR",
    ville: "Dakar",
    specialite: "√âlectricit√©",
    annees_experience: 12,
    photo_profil: "https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=800",
    tarif_journee: 16000,
    description: "√âlectricien certifi√©. Installation, mise aux normes.",
    nb_projets_realises: 95,
    whatsapp: TEAM_WA,
    slug: "abdoulaye-sarr-dakar",
    _isPlaceholder: true
  },
  {
    id: "pb-4",
    nom_complet: "Mamadou BA",
    entreprise: "MENUISERIE BA",
    ville: "Saly",
    specialite: "Menuiserie",
    annees_experience: 18,
    photo_profil: "https://images.unsplash.com/photo-1590846406792-0adc7f938f1d?w=800",
    tarif_journee: 20000,
    description: "Menuisier artisan. Fabrication sur mesure.",
    nb_projets_realises: 150,
    whatsapp: TEAM_WA,
    slug: "mamadou-ba-saly",
    _isPlaceholder: true
  },
  {
    id: "pb-5",
    nom_complet: "Cheikh NDIAYE",
    entreprise: "PEINTURE NDIAYE",
    ville: "Mbour",
    specialite: "Peinture",
    annees_experience: 8,
    photo_profil: "https://images.unsplash.com/photo-1562259949-e8e7689d7828?w=800",
    tarif_journee: 12000,
    description: "Peintre professionnel. Int√©rieur, ext√©rieur, fa√ßades.",
    nb_projets_realises: 70,
    whatsapp: TEAM_WA,
    slug: "cheikh-ndiaye-mbour",
    _isPlaceholder: true
  }
];

// ‚úÖ FETCH DB (SANS FILTRES - AFFICHE TOUT)
async function fetchArtisans(){
  try {
    console.log("üîç Fetching artisans from DB...");
    
    // ‚úÖ PAS DE FILTRES - ON PREND TOUT
    const { data, error } = await sb
      .from("digiy_build_artisans")
      .select("*");

    if (error) {
      console.warn("‚ùå Erreur DB:", error.message);
      debugEl.innerHTML = `‚ùå Erreur DB: ${error.message}`;
      return [];
    }
    
    console.log("‚úÖ Artisans trouv√©s en DB:", data);
    debugEl.innerHTML = `
      ‚úÖ DB connect√©e !<br>
      üìä Artisans en DB: ${data.length}<br>
      üìã D√©tails: ${JSON.stringify(data.map(a => a.nom_complet), null, 2)}
    `;
    
    return data || [];
    
  } catch(e) {
    console.error("‚ùå Fetch error:", e);
    debugEl.innerHTML = `‚ùå Fetch error: ${e.message}`;
    return [];
  }
}

// ‚úÖ CARD
function card(a){
  const nom = a.nom_complet || "Artisan";
  const ent = a.entreprise ? `<div class="entreprise">${a.entreprise}</div>` : '';
  const ville = a.ville || "‚Äî";
  const spec = a.specialite || "Multi";
  const photo = a.photo_profil || "https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=800";
  const tarif = a.tarif_journee ? `${a.tarif_journee.toLocaleString()} F/jour` : "Sur devis";
  const exp = a.annees_experience ? `${a.annees_experience} ans` : "";
  const proj = a.nb_projets_realises ? `${a.nb_projets_realises} projets` : "";
  const wa = a.whatsapp || a.phone || TEAM_WA;
  
  // ‚úÖ Distingue vrais artisans des placebots
  const cardClass = a._isPlaceholder ? 'card placeholder' : 'card real';
  const badge = a._isPlaceholder 
    ? '<div class="badge" style="background:#f97316;color:#000">üì∏ Exemple</div>' 
    : '<div class="badge real">‚úÖ V√âRIFI√â</div>';
  
  return `
    <div class="${cardClass}">
      <div class="photo">
        <img src="${photo}" alt="${nom}" loading="lazy">
      </div>
      <div class="name">${nom}</div>
      ${ent}
      <div class="type">${spec} ‚Ä¢ ${ville}</div>
      <div class="badges">
        ${badge}
        <div class="badge">0% commission</div>
        ${exp ? `<div class="badge">${exp}</div>` : ''}
        ${proj ? `<div class="badge">${proj}</div>` : ''}
      </div>
      <div class="desc">${a.description || "Artisan professionnel. Contact direct."}</div>
      <div style="color:var(--muted);font-size:14px;margin-bottom:10px">Tarif: ${tarif}</div>
      <button class="btn btn-primary" onclick="devis('${String(a.id).replace(/'/g,"\\'")}','${nom.replace(/'/g,"\\'")}')">üìã Demander devis</button>
      <button class="btn btn-wa" onclick="wa('${wa}','${nom.replace(/'/g,"\\'")}')">üì≤ WhatsApp</button>
    </div>
  `;
}

// ‚úÖ ACTIONS
function wa(phone, nom){
  const msg = `Bonjour ${nom}, devis via DIGIY BUILD.`;
  window.open(`https://wa.me/${phone.replace(/\D/g,'')}?text=${encodeURIComponent(msg)}`, '_blank');
}
window.wa = wa;

function devis(id, nom){
  if(String(id).startsWith('pb-')){
    wa(TEAM_WA, nom);
  } else {
    location.href = `./request.html?artisan_id=${id}&nom=${encodeURIComponent(nom)}`;
  }
}
window.devis = devis;

// ‚úÖ RENDER
async function render(){
  grid.innerHTML = '<div class="loading">Chargement...</div>';
  
  const dbArtisans = await fetchArtisans();
  
  console.log("üìä Artisans DB:", dbArtisans.length);
  console.log("üìä Placebots:", PLACEBOTS.length);
  
  // ‚úÖ AFFICHE VRAIS ARTISANS EN PREMIER, PUIS PLACEBOTS
  const artisans = [...dbArtisans, ...PLACEBOTS];
  
  console.log("üìä Total √† afficher:", artisans.length);
  
  if(!artisans.length){
    grid.innerHTML = '<div class="loading">Aucun artisan disponible.</div>';
    return;
  }
  
  grid.innerHTML = artisans.map(a => card(a)).join('');
  
  // ‚úÖ Update debug
  debugEl.innerHTML += `<br>‚úÖ Total affich√©: ${artisans.length} (${dbArtisans.length} vrais + ${PLACEBOTS.length} exemples)`;
}

render();
</script>

</body>
</html>
